<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Counties GeoJSON - Leaflet</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html,body,#map { height:100%; margin:0; padding:0; }
    .info { font-family: Arial, sans-serif; font-size:13px; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // create map
    const map = L.map('map').setView([37.8, -96], 5);

    // basemap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);

    // counties layer
    const countiesLayer = L.geoJSON(null, {
      style: feature => {
        const affiliated = feature.properties && feature.properties.Affiliated;
        if (affiliated && affiliated.toLowerCase() === "yes") {
          return {
            color: '#000000',
            weight: 1,
            fillColor: 'gold',
            fillOpacity: 0.6
          };
        } else {
          return {
            color: '#000000',
            weight: 1,
            fillOpacity: 0.5,
            fillColor: '#000000'
          };
        }
      },
      onEachFeature: (feature, layer) => {
        const affiliated = feature.properties && feature.properties.Affiliated;
        if (affiliated && affiliated.toLowerCase() === "yes") {
          const name = (feature.properties.NAME || feature.properties.name || 'Unnamed');
          const chair = feature.properties.Chair || 'N/A';
          const logo = feature.properties.Logo || 'N/A';

          const popupContent = `
            <img src = "${logo}" alt="County Affiliate Logo" class = 'popup-image'><br>
            <strong>${name}</strong><br>
            Chair: ${chair}
          `;

          layer.bindPopup(popupContent);
        }
      }
    }).addTo(map);

    // load GeoJSON
    fetch('KyCounties.geojson')
      .then(resp => {
        if (!resp.ok) throw new Error(`HTTP ${resp.status} ${resp.statusText}`);
        return resp.json();
      })
      .then(data => {
        countiesLayer.addData(data);
        const bounds = countiesLayer.getBounds();
        if (bounds.isValid()) map.fitBounds(bounds, { padding: [20, 20] });
      })
      .catch(err => {
        console.error('GeoJSON load error:', err);
        L.control({ position: 'topright' }).onAdd = function () {
          const div = L.DomUtil.create('div', 'info');
          div.style.background = 'white';
          div.style.padding = '6px';
          div.style.border = '1px solid rgba(0,0,0,0.2)';
          div.innerHTML = `<strong>Error loading counties.geojson</strong><br>${err.message}`;
          return div;
        }.addTo(map);
      });
  </script>
</body>
</html>

